<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Brexit Commodity Import and Export Network</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="src/components/Transport/Transport.css">
    <link rel="stylesheet" href="src/components/CountryScale/CountryScale.css">
    <link rel="stylesheet" href="src/components/RegionScale/RegionScale.css">
    <link rel="stylesheet" href="src/components/GoodsType/GoodsType.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    <!-- 添加Mapbox GL JS脚本和样式 -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
  </head>
  <body>
    <!-- Full-screen Background Animation -->
    <div id="background-animation" style="position:fixed;top:0;left:5%;right:5%;width:90vw;height:100vh;z-index:0;pointer-events:none;opacity:0.25;background-size:cover;background-position:center;margin:0 auto;padding:0;"></div>
    
    <!-- Side Navigation Dots -->
    <div class="side-nav" id="side-nav">
      <div class="side-nav-dot" data-target="section1"></div>
      <div class="side-nav-dot" data-target="section1b"></div>
      <div class="side-nav-dot" data-target="section4"></div>
      <div class="side-nav-dot" data-target="section5"></div>
      <div class="side-nav-dot" data-target="section6"></div>
      <div class="side-nav-dot" data-target="section7"></div>
      <div class="side-nav-dot" data-target="section8"></div>
      <div class="side-nav-dot" data-target="section9"></div>
    </div>
    
    <!-- Load Lottie library and initialize animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    <script>
      // Initialize background animation
      document.addEventListener('DOMContentLoaded', function() {
        // Background animation
        const anim = lottie.loadAnimation({
          container: document.getElementById('background-animation'),
          renderer: 'svg',
          loop: true,
          autoplay: true,
          path: 'https://raw.githubusercontent.com/Cihshee/CASA0003_minnni_project/main/public/Chevrons-moving-down.json',
          rendererSettings: {
            preserveAspectRatio: 'xMidYMid slice',
            className: 'lottie-svg-fullscreen'
          }
        });
        
        // 在动画加载完成后减慢速度
        anim.addEventListener('DOMLoaded', function() {
          // 设置为0.3倍速，使动画更慢
          anim.setSpeed(0.3);
          console.log('Animation speed set to 0.3');
        });
        
        // Ensure the animation container covers the desired viewport area
        function resizeAnimation() {
          const container = document.getElementById('background-animation');
          container.style.width = (window.innerWidth * 0.9) + 'px';
          container.style.height = window.innerHeight + 'px';
          container.style.left = '5%';
          container.style.right = '5%';
        }
        
        // Call resize on load and on window resize
        resizeAnimation();
        window.addEventListener('resize', resizeAnimation);
      });
    </script>

    <script>
      // Side nav scroll and highlight logic
      const dots = Array.from(document.querySelectorAll('.side-nav-dot'));
      const sections = [
        'section1','section1b','section4','section5','section6','section7','section8','section9'
      ].map(id => document.getElementById(id));
      function updateActiveDot() {
        let idx = 0;
        const scrollY = window.scrollY || window.pageYOffset;
        for (let i = 0; i < sections.length; i++) {
          if (sections[i]) {
            const rect = sections[i].getBoundingClientRect();
            if (rect.top <= window.innerHeight * 0.33) idx = i;
          }
        }
        dots.forEach((d, i) => d.classList.toggle('active', i === idx));
      }
      window.addEventListener('scroll', updateActiveDot);
      window.addEventListener('resize', updateActiveDot);
      updateActiveDot();
      dots.forEach((dot, i) => {
        dot.addEventListener('click', e => {
          e.preventDefault();
          if (sections[i]) sections[i].scrollIntoView({behavior:'smooth'});
        });
      });
    </script>

    <!-- 导航栏 -->
    <nav class="navbar">
      <ul>
        <li><a href="#section1" class="nav-link">Homepage</a></li>
        <li><a href="#section4" class="nav-link">Overview</a></li>
        <li><a href="#section5" class="nav-link">Trade Patterns</a></li>
        <li><a href="#section6" class="nav-link">Key Commodities</a></li>
        <li><a href="#section7" class="nav-link">Transport Modes</a></li>
        <li><a href="#section8" class="nav-link">Insights</a></li>
        <li><a href="#section9" class="nav-link">Our Team</a></li>
    </nav>

    <!-- 主要内容区域 -->
    <main>
      <section id="section1" class="full-page hero-section" style="position:relative;overflow:hidden;display:flex;align-items:flex-start;justify-content:center;min-height:100vh;background:transparent;">
        <div class="hero-content" style="position:relative;z-index:2;display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-start;max-width:1200px;margin:2vh auto 0 auto;padding-left:0;">
          <div id="lottie-title" style="width:1800px;max-width:99vw;height:500px;min-height:200px;display:flex;align-items:center;justify-content:flex-start;pointer-events:none;margin-bottom:0;margin-left:-400px;">
            <div id="lottie-title-player" style="width:1800px;max-width:99vw;height:500px;"></div>
          </div>
          <p class="hero-desc highlight-desc" style="margin-top:-18px;margin-bottom:0;font-size:1.25rem;margin-left:120px;">
            An Exploration Of The Impact Of Brexit On The Global Commodity Import And Export Trade Network.
          </p>
        </div>
      </section>

      <section id="section1b" class="full-page hero-section" style="position:relative;overflow:hidden;display:flex;align-items:flex-start;justify-content:center;min-height:60vh;background:transparent;">
        <video autoplay muted loop playsinline id="bg-video"
          style="position:relative;width:50vw;height:auto;max-width:1200px;max-height:100vh;object-fit:cover;z-index:0;border-radius:1.5rem;box-shadow:0 4px 32px rgba(0,0,0,0.18);border:4px solid #444;margin-bottom:20vh;">
          <source src="public/cover.mp4" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </section>

      <script>
        lottie.loadAnimation({
          container: document.getElementById('lottie-title-player'),
          renderer: 'svg',
          loop: true,
          autoplay: true,
          path: 'https://raw.githubusercontent.com/Cihshee/CASA0003_minnni_project/main/public/Bouncing-period-remix.json'
        });
      </script>

      <section id="section4" class="full-page">
        <div class="content">
          <!-- 使用 Country Scale 组件 -->
          <div id="country-scale-container"></div>
        </div>
      </section>

      <section id="section5" class="full-page"> 
        <div class="content">
          <!-- 使用 Region Scale 组件 -->
          <div id="region-scale-container"></div>
        </div>
      </section>

      <section id="section6" class="full-page">
        <div class="content">
          <div id="goods-types-container"></div>
          <div id="goods-type-detail-section"></div>
        </div>
      </section>

      <section id="section7" class="full-page" style="min-height: 100vh;">
        <div class="content-transport">
          <!-- 使用 Transportation 组件 -->
          <div id="transport-container"></div>
        </div>
      </section>

      <section id="section8" class="full-page">
        <div class="content">
          
        </div>
      </section>

      <section id="section9" class="full-page">
        <div class="content">
          
        </div>
      </section>

    <script>
      // 加载 Country Scale 组件
      fetch('src/components/CountryScale/CountryScale.html')
        .then(response => response.text())
        .then(html => {
          document.getElementById('country-scale-container').innerHTML = html;
          // 加载组件动画脚本
          const script = document.createElement('script');
          script.src = 'src/components/CountryScale/CountryScale.js';
          document.body.appendChild(script);
        });

      // 加载 Region Scale 组件
      fetch('src/components/RegionScale/RegionScale.html')
        .then(response => response.text())
        .then(html => {
          document.getElementById('region-scale-container').innerHTML = html;
          // 加载组件动画脚本
          const script = document.createElement('script');
          script.src = 'src/components/RegionScale/RegionScale.js';
          document.body.appendChild(script);
        });

      // 加载 Goods Types 组件
      fetch('src/components/GoodsType/GoodsType.html')
        .then(response => response.text())
        .then(html => {
          document.getElementById('goods-types-container').innerHTML = html;
          // 加载组件动画脚本
          const script = document.createElement('script');
          script.src = 'src/components/GoodsType/GoodsType.js';
          document.body.appendChild(script);
        });

      // 加载 Transportation 组件
      fetch('src/components/Transport/Transport.html')
        .then(response => response.text())
        .then(html => {
          document.getElementById('transport-container').innerHTML = html;
          // 加载组件动画脚本
          const script = document.createElement('script');
          script.src = 'src/components/Transport/Transport.js';
          document.body.appendChild(script);
        });

    </script>
    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // 删除原有的自动吸附和自动滑动功能代码
      // 仅保留基本的部分用于侧边导航点的正常工作
      (function() {
        const sections = Array.from(document.querySelectorAll('.full-page'));
        
        function findCurrentSection() {
          let idx = 0;
          for (let i = 0; i < sections.length; i++) {
            const rect = sections[i].getBoundingClientRect();
            if (rect.top <= window.innerHeight * 0.33) idx = i;
          }
          return idx;
        }
        
        // 保留滚动位置监听以更新侧边导航点状态
        window.addEventListener('scroll', function() {
          const currentIdx = findCurrentSection();
          const dots = Array.from(document.querySelectorAll('.side-nav-dot'));
          dots.forEach((d, i) => d.classList.toggle('active', i === currentIdx));
        });
        
        // 保留点击侧边导航点的功能，但使用普通滚动
        const dots = Array.from(document.querySelectorAll('.side-nav-dot'));
        dots.forEach((dot, i) => {
          dot.addEventListener('click', e => {
            e.preventDefault();
            const sectionId = dot.getAttribute('data-target');
            const section = document.getElementById(sectionId);
            if (section) {
              window.scrollTo({
                top: section.offsetTop,
                behavior: 'smooth'
              });
            }
          });
        });
      })();
    </script>
  </body>
</html>
